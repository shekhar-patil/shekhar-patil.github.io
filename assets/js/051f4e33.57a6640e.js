"use strict";(self.webpackChunkshekhar_patil_github_io=self.webpackChunkshekhar_patil_github_io||[]).push([[8324],{4099:e=>{e.exports=JSON.parse('{"permalink":"/blog/distroless-migration","source":"@site/blog/2025-11-05-distroless-container/index.md","title":"Migrating to Distroless Containers \u2014 My Real World Journey","description":"A practical guide on what distroless containers are, their pros and cons, and real challenges I faced while migrating microservices to distroless.","date":"2025-11-05T00:00:00.000Z","tags":[{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"containers","permalink":"/blog/tags/containers"},{"inline":true,"label":"distroless","permalink":"/blog/tags/distroless"},{"inline":false,"label":"DevOps","permalink":"/blog/tags/devops","description":"DevOps combines software development and IT operations..."},{"inline":false,"label":"Golang","permalink":"/blog/tags/golang","description":"Go is a statically typed, compiled high-level programming language designed at Google..."},{"inline":true,"label":"kubernetes","permalink":"/blog/tags/kubernetes"}],"readingTime":4.31,"hasTruncateMarker":true,"authors":[{"name":"Shekhar Patil","title":"Full stack developer.","url":"https://github.com/shekhar-patil","github":"shekhar-patil","linkedin":"https://www.linkedin.com/in/shekhar-patil-834462135/","imageURL":"https://avatars.githubusercontent.com/u/16961675?s=400&u=70e54719e239d1148c24bc8661a72ee9e59f420d&v=4","key":"shekhar-patil","page":null}],"frontMatter":{"slug":"distroless-migration","title":"Migrating to Distroless Containers \u2014 My Real World Journey","description":"A practical guide on what distroless containers are, their pros and cons, and real challenges I faced while migrating microservices to distroless.","tags":["docker","containers","distroless","devops","golang","kubernetes"],"date":"2025-11-05T00:00:00.000Z","authors":"shekhar-patil"},"unlisted":false,"nextItem":{"title":"How to Terminate Goroutines in Go","permalink":"/blog/terminate-goroutines"}}')},7946:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});var i=s(4099),t=s(4848),r=s(8453);const l={slug:"distroless-migration",title:"Migrating to Distroless Containers \u2014 My Real World Journey",description:"A practical guide on what distroless containers are, their pros and cons, and real challenges I faced while migrating microservices to distroless.",tags:["docker","containers","distroless","devops","golang","kubernetes"],date:new Date("2025-11-05T00:00:00.000Z"),authors:"shekhar-patil"},a="Migrating to Distroless Containers \u2014 My Real-World Journey",o={authorsImageUrls:[void 0]},d=[{value:"What Are Distroless Containers?",id:"what-are-distroless-containers",level:2},{value:"Why Go Distroless?",id:"why-go-distroless",level:2},{value:"What\u2019s Missing (The Disadvantages)",id:"whats-missing-the-disadvantages",level:2},{value:"No Shell Access",id:"no-shell-access",level:3},{value:"Harder Debugging and Troubleshooting",id:"harder-debugging-and-troubleshooting",level:3},{value:"Additional Build Complexity",id:"additional-build-complexity",level:3},{value:"My Migration Experience \u2014 Challenges and Learnings",id:"my-migration-experience--challenges-and-learnings",level:2},{value:"Replacing Shell Scripts",id:"replacing-shell-scripts",level:3},{value:"Using Init Containers for Legacy Tasks",id:"using-init-containers-for-legacy-tasks",level:3},{value:"Debugging Without a Shell",id:"debugging-without-a-shell",level:3},{value:"Multi-Stage Docker Builds",id:"multi-stage-docker-builds",level:3},{value:"Other Lessons Learned",id:"other-lessons-learned",level:2},{value:"Final Thoughts",id:"final-thoughts",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Recently, I\u2019ve been working on migrating multiple services to ",(0,t.jsx)(n.strong,{children:"distroless containers"}),", and it\u2019s been quite an interesting learning curve. When I first heard about \u201cdistroless,\u201d I assumed it was just another buzzword in the container world \u2014 until I actually started using it in production."]}),"\n",(0,t.jsx)(n.p,{children:"In this post, I\u2019ll share what distroless containers are, their advantages and disadvantages, the challenges I faced during migration, and a few lessons learned along the way."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"what-are-distroless-containers",children:"What Are Distroless Containers?"}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.strong,{children:"distroless container"})," is a Docker image that does not include a full Linux distribution like Ubuntu, Debian, or Alpine.\nInstead, it only contains what your application actually needs to run \u2014 your ",(0,t.jsx)(n.strong,{children:"compiled binary"})," and its ",(0,t.jsx)(n.strong,{children:"runtime dependencies"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"That\u2019s it:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["No shell (",(0,t.jsx)(n.code,{children:"bash"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["No package manager (",(0,t.jsx)(n.code,{children:"apt"}),", ",(0,t.jsx)(n.code,{children:"yum"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"No unnecessary system tools or libraries"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Google popularized the concept through their ",(0,t.jsx)(n.a,{href:"https://github.com/GoogleContainerTools/distroless",children:"Distroless project"}),", focusing on making containers ",(0,t.jsx)(n.strong,{children:"smaller, more secure, and production-optimized"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"why-go-distroless",children:"Why Go Distroless?"}),"\n",(0,t.jsxs)(n.p,{children:["When I began exploring distroless images, my main motivation was ",(0,t.jsx)(n.strong,{children:"security and performance"}),", but I soon discovered other benefits that made the migration worthwhile."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reduced Attack Surface"})," \u2014 Without shells or package managers, attackers have little to exploit. They can\u2019t simply exec into your container and run arbitrary commands."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Smaller Image Size"})," \u2014 Removing unnecessary OS layers makes images significantly lighter, leading to faster builds, pulls, and deployments."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Faster Startup and Pull Times"})," \u2014 Smaller images mean quicker startups, which is especially helpful in Kubernetes where pods often restart or scale rapidly."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Simplified Dependency Management"})," \u2014 You include only the dependencies your app truly needs, nothing more."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"whats-missing-the-disadvantages",children:"What\u2019s Missing (The Disadvantages)"}),"\n",(0,t.jsx)(n.p,{children:"Distroless containers simplify production deployments but introduce some trade-offs."}),"\n",(0,t.jsx)(n.h3,{id:"no-shell-access",children:"No Shell Access"}),"\n",(0,t.jsxs)(n.p,{children:["You can\u2019t just ",(0,t.jsx)(n.code,{children:"docker exec -it <container> /bin/bash"})," anymore.\nFor teams that rely on in-container debugging, this can feel restrictive."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Tip:"})," Use ",(0,t.jsx)(n.em,{children:"debug sidecars"})," or temporarily swap your base image with a non-distroless version when troubleshooting."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"harder-debugging-and-troubleshooting",children:"Harder Debugging and Troubleshooting"}),"\n",(0,t.jsxs)(n.p,{children:["No ",(0,t.jsx)(n.code,{children:"curl"}),", ",(0,t.jsx)(n.code,{children:"netcat"}),", ",(0,t.jsx)(n.code,{children:"ps"}),", or ",(0,t.jsx)(n.code,{children:"top"}),". You\u2019ll need to invest in better observability \u2014 structured logging, health probes, and metrics become your main debugging tools."]}),"\n",(0,t.jsx)(n.h3,{id:"additional-build-complexity",children:"Additional Build Complexity"}),"\n",(0,t.jsxs)(n.p,{children:["Since distroless containers only hold your final binary, you\u2019ll need ",(0,t.jsx)(n.strong,{children:"multi-stage builds"})," to compile and package your app separately."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"my-migration-experience--challenges-and-learnings",children:"My Migration Experience \u2014 Challenges and Learnings"}),"\n",(0,t.jsx)(n.p,{children:"When we began migrating existing services to distroless containers, I ran into several practical challenges that weren\u2019t obvious at first."}),"\n",(0,t.jsx)(n.h3,{id:"replacing-shell-scripts",children:"Replacing Shell Scripts"}),"\n",(0,t.jsx)(n.p,{children:"Our older containers depended heavily on shell scripts for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Setting environment variables"}),"\n",(0,t.jsx)(n.li,{children:"Running database migrations"}),"\n",(0,t.jsx)(n.li,{children:"Checking dependencies before startup"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"With no shell available, these scripts had to go."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution:"})," I rewrote many of them in ",(0,t.jsx)(n.strong,{children:"Go"}),".\nThis made the startup logic type-safe, testable, and independent of any external shell."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Old startup.sh\n#!/bin/bash\necho "Waiting for database..."\nuntil nc -z $DB_HOST 5432; do\n  sleep 1\ndone\necho "Database is up!"\n./app\n'})}),"\n",(0,t.jsx)(n.p,{children:"Converted to Go:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "net"\n    "os"\n    "time"\n)\n\nfunc waitForDB(host string, port string) {\n    for {\n        conn, err := net.DialTimeout("tcp", net.JoinHostPort(host, port), 2*time.Second)\n        if err == nil {\n            conn.Close()\n            fmt.Println("Database is up!")\n            return\n        }\n        fmt.Println("Waiting for database...")\n        time.Sleep(1 * time.Second)\n    }\n}\n\nfunc main() {\n    waitForDB(os.Getenv("DB_HOST"), "5432")\n    // Start app here\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"This made each container self-contained and fully distroless-compatible."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"using-init-containers-for-legacy-tasks",children:"Using Init Containers for Legacy Tasks"}),"\n",(0,t.jsxs)(n.p,{children:["Some older scripts were too complex to rewrite right away.\nFor those, I used ",(0,t.jsx)(n.strong,{children:"Kubernetes init containers"})," (based on lightweight images like Alpine or Debian) to handle:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Database migrations"}),"\n",(0,t.jsx)(n.li,{children:"Configuration setup"}),"\n",(0,t.jsx)(n.li,{children:"Any one-time initialization logic"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["After the init container finished, the main service ran inside the ",(0,t.jsx)(n.strong,{children:"distroless container"}),".\nThis hybrid approach helped us migrate gradually without blocking releases."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"debugging-without-a-shell",children:"Debugging Without a Shell"}),"\n",(0,t.jsxs)(n.p,{children:["Debugging was initially tough. The usual \u201c",(0,t.jsx)(n.code,{children:"docker exec"})," into the pod\u201d approach no longer worked."]}),"\n",(0,t.jsx)(n.p,{children:"Here\u2019s what helped:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Running ",(0,t.jsx)(n.strong,{children:"debug tools"})," inside ephemeral containers (",(0,t.jsx)(n.code,{children:"kubectl debug"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Adding ",(0,t.jsx)(n.strong,{children:"structured logs"})," with proper log levels"]}),"\n",(0,t.jsxs)(n.li,{children:["Setting up ",(0,t.jsx)(n.strong,{children:"readiness and liveness probes"})," for better observability"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Eventually, I relied less on manual debugging and more on telemetry and metrics."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"multi-stage-docker-builds",children:"Multi-Stage Docker Builds"}),"\n",(0,t.jsx)(n.p,{children:"Here\u2019s a typical multi-stage Dockerfile I used after migration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dockerfile",children:'# Stage 1: Build the binary\nFROM golang:1.23 AS builder\nWORKDIR /app\nCOPY . .\nRUN go build -o main .\n\n# Stage 2: Run using a distroless base\nFROM gcr.io/distroless/base-debian12\nWORKDIR /\nCOPY --from=builder /app/main /\nUSER nonroot:nonroot\nENTRYPOINT ["/main"]\n'})}),"\n",(0,t.jsx)(n.p,{children:"This approach kept the final image small, secure, and free from unnecessary build tools."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"other-lessons-learned",children:"Other Lessons Learned"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pin image digests"})," instead of tags \u2014 distroless images are updated frequently."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Run as non-root"})," \u2014 distroless supports ",(0,t.jsx)(n.code,{children:"nonroot:nonroot"})," users out of the box."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use consistent base images"})," across services to simplify maintenance."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Document startup logic"})," \u2014 once shell scripts are removed, clarity becomes vital for future maintainers."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"final-thoughts",children:"Final Thoughts"}),"\n",(0,t.jsxs)(n.p,{children:["Migrating to distroless containers isn\u2019t just a technical refactor \u2014 it\u2019s a ",(0,t.jsx)(n.strong,{children:"mindset shift"}),".\nYou stop treating containers as mini operating systems and start treating them as ",(0,t.jsx)(n.strong,{children:"immutable application packages"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The transition can feel challenging, especially if your workflows depend on shell utilities, but the benefits in ",(0,t.jsx)(n.strong,{children:"security"}),", ",(0,t.jsx)(n.strong,{children:"performance"}),", and ",(0,t.jsx)(n.strong,{children:"consistency"})," make it absolutely worth it."]}),"\n",(0,t.jsx)(n.p,{children:"If you\u2019re planning to go distroless:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Start with one or two services."}),"\n",(0,t.jsx)(n.li,{children:"Keep a debug-friendly fallback."}),"\n",(0,t.jsx)(n.li,{children:"Refactor incrementally."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"By the end, your containers will be lighter, faster, and truly production-ready."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var i=s(6540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);