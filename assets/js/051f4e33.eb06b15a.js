"use strict";(self.webpackChunkshekhar_patil_github_io=self.webpackChunkshekhar_patil_github_io||[]).push([[8324],{4099:e=>{e.exports=JSON.parse('{"permalink":"/blog/distroless-migration","source":"@site/blog/2025-11-05-distroless-container/index.md","title":"Migrating to Distroless Containers \u2014 My Real World Journey","description":"A practical guide on what distroless containers are, their pros and cons, and real challenges I faced while migrating microservices to distroless.","date":"2025-11-05T00:00:00.000Z","tags":[{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"containers","permalink":"/blog/tags/containers"},{"inline":true,"label":"distroless","permalink":"/blog/tags/distroless"},{"inline":false,"label":"DevOps","permalink":"/blog/tags/devops","description":"DevOps combines software development and IT operations..."},{"inline":false,"label":"Golang","permalink":"/blog/tags/golang","description":"Go is a statically typed, compiled high-level programming language designed at Google..."},{"inline":true,"label":"kubernetes","permalink":"/blog/tags/kubernetes"}],"readingTime":4.51,"hasTruncateMarker":true,"authors":[{"name":"Shekhar Patil","title":"Full stack developer.","url":"https://github.com/shekhar-patil","github":"shekhar-patil","linkedin":"https://www.linkedin.com/in/shekhar-patil-834462135/","imageURL":"https://avatars.githubusercontent.com/u/16961675?s=400&u=70e54719e239d1148c24bc8661a72ee9e59f420d&v=4","key":"shekhar-patil","page":null}],"frontMatter":{"slug":"distroless-migration","title":"Migrating to Distroless Containers \u2014 My Real World Journey","description":"A practical guide on what distroless containers are, their pros and cons, and real challenges I faced while migrating microservices to distroless.","tags":["docker","containers","distroless","devops","golang","kubernetes"],"date":"2025-11-05T00:00:00.000Z","authors":"shekhar-patil"},"unlisted":false,"nextItem":{"title":"How to Terminate Goroutines in Go","permalink":"/blog/terminate-goroutines"}}')},7946:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var i=s(4099),t=s(4848),r=s(8453);const a={slug:"distroless-migration",title:"Migrating to Distroless Containers \u2014 My Real World Journey",description:"A practical guide on what distroless containers are, their pros and cons, and real challenges I faced while migrating microservices to distroless.",tags:["docker","containers","distroless","devops","golang","kubernetes"],date:new Date("2025-11-05T00:00:00.000Z"),authors:"shekhar-patil"},l="Migrating to Distroless Containers \u2014 My Real-World Journey",o={authorsImageUrls:[void 0]},d=[{value:"What Are Distroless Containers?",id:"what-are-distroless-containers",level:2},{value:"Why Go Distroless?",id:"why-go-distroless",level:2},{value:"1. Reduced Attack Surface",id:"1-reduced-attack-surface",level:3},{value:"2. Smaller Image Size",id:"2-smaller-image-size",level:3},{value:"3. Faster Startup and Pull Times",id:"3-faster-startup-and-pull-times",level:3},{value:"4. Simplified Dependency Management",id:"4-simplified-dependency-management",level:3},{value:"What\u2019s Missing (The Disadvantages)",id:"whats-missing-the-disadvantages",level:2},{value:"1. No Shell Access",id:"1-no-shell-access",level:3},{value:"2. Harder Debugging and Troubleshooting",id:"2-harder-debugging-and-troubleshooting",level:3},{value:"3. Additional Build Complexity",id:"3-additional-build-complexity",level:3},{value:"My Migration Experience \u2014 Challenges and Learnings",id:"my-migration-experience--challenges-and-learnings",level:2},{value:"1. Replacing Shell Scripts",id:"1-replacing-shell-scripts",level:3},{value:"2. Using Init Containers for Legacy Tasks",id:"2-using-init-containers-for-legacy-tasks",level:3},{value:"3. Debugging Without a Shell",id:"3-debugging-without-a-shell",level:3},{value:"4. Multi-Stage Docker Builds",id:"4-multi-stage-docker-builds",level:3},{value:"Other Lessons Learned",id:"other-lessons-learned",level:2},{value:"Final Thoughts",id:"final-thoughts",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Recently, I\u2019ve been working on migrating multiple services to ",(0,t.jsx)(n.strong,{children:"distroless containers"}),", and it\u2019s been quite an interesting learning curve. When I first heard about \u201cdistroless,\u201d I assumed it was just another buzzword in the container world \u2014 until I actually started using it in production."]}),"\n",(0,t.jsx)(n.p,{children:"In this post, I\u2019ll share what distroless containers are, their advantages and disadvantages, the challenges I faced during migration, and a few lessons learned along the way."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"what-are-distroless-containers",children:"What Are Distroless Containers?"}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.strong,{children:"distroless container"})," is a Docker image that does not include a full Linux distribution like Ubuntu, Debian, or Alpine. Instead, it only contains:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Your application binary"}),"\n",(0,t.jsx)(n.li,{children:"The runtime dependencies required to execute that binary"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["That\u2019s it. No shell (",(0,t.jsx)(n.code,{children:"bash"}),"), no package manager (",(0,t.jsx)(n.code,{children:"apt"}),", ",(0,t.jsx)(n.code,{children:"yum"}),"), and no unnecessary tools."]}),"\n",(0,t.jsxs)(n.p,{children:["Google popularized the concept through their ",(0,t.jsx)(n.a,{href:"https://github.com/GoogleContainerTools/distroless",children:"Distroless project"}),", aiming to make containers smaller, more secure, and production-focused."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"why-go-distroless",children:"Why Go Distroless?"}),"\n",(0,t.jsxs)(n.p,{children:["When I started exploring distroless images, my main motivation was ",(0,t.jsx)(n.strong,{children:"security and performance"}),". But once I began migrating, I discovered several other benefits."]}),"\n",(0,t.jsx)(n.h3,{id:"1-reduced-attack-surface",children:"1. Reduced Attack Surface"}),"\n",(0,t.jsx)(n.p,{children:"Since there\u2019s no shell or package manager, attackers have very limited options to exploit. They can\u2019t simply exec into the container and run commands.\nEssentially, there\u2019s nothing to attack beyond your application itself."}),"\n",(0,t.jsx)(n.h3,{id:"2-smaller-image-size",children:"2. Smaller Image Size"}),"\n",(0,t.jsx)(n.p,{children:"Distroless images remove unnecessary OS layers, reducing the image size significantly.\nSmaller images mean faster deployments and less network overhead."}),"\n",(0,t.jsx)(n.h3,{id:"3-faster-startup-and-pull-times",children:"3. Faster Startup and Pull Times"}),"\n",(0,t.jsx)(n.p,{children:"Because they\u2019re lightweight, distroless containers pull and start up faster \u2014 a big advantage in Kubernetes environments where pods are frequently restarted or scaled."}),"\n",(0,t.jsx)(n.h3,{id:"4-simplified-dependency-management",children:"4. Simplified Dependency Management"}),"\n",(0,t.jsx)(n.p,{children:"You only include what your application truly needs \u2014 no extra tools, libraries, or system packages."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"whats-missing-the-disadvantages",children:"What\u2019s Missing (The Disadvantages)"}),"\n",(0,t.jsx)(n.p,{children:"Distroless containers bring simplicity, but that simplicity also creates new challenges."}),"\n",(0,t.jsx)(n.h3,{id:"1-no-shell-access",children:"1. No Shell Access"}),"\n",(0,t.jsxs)(n.p,{children:["You can\u2019t just ",(0,t.jsx)(n.code,{children:"docker exec -it <container> /bin/bash"})," anymore.\nFor teams used to debugging directly inside containers, this can be frustrating at first."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Tip:"})," I learned to use ",(0,t.jsx)(n.em,{children:"debug sidecars"})," or temporarily replace the base image with a non-distroless version for troubleshooting."]}),"\n",(0,t.jsx)(n.h3,{id:"2-harder-debugging-and-troubleshooting",children:"2. Harder Debugging and Troubleshooting"}),"\n",(0,t.jsxs)(n.p,{children:["There\u2019s no ",(0,t.jsx)(n.code,{children:"curl"}),", ",(0,t.jsx)(n.code,{children:"netcat"}),", ",(0,t.jsx)(n.code,{children:"ps"}),", or ",(0,t.jsx)(n.code,{children:"top"}),". You need to plan observability from the start.\nTools like Prometheus exporters, structured logging, and health probes become essential."]}),"\n",(0,t.jsx)(n.h3,{id:"3-additional-build-complexity",children:"3. Additional Build Complexity"}),"\n",(0,t.jsxs)(n.p,{children:["Since distroless images only contain your final binary, you must use ",(0,t.jsx)(n.strong,{children:"multi-stage Docker builds"})," \u2014 one stage for compiling, and another for running the minimal image."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"my-migration-experience--challenges-and-learnings",children:"My Migration Experience \u2014 Challenges and Learnings"}),"\n",(0,t.jsx)(n.p,{children:"When we began migrating our existing services to distroless containers, I encountered several practical issues that weren\u2019t immediately obvious."}),"\n",(0,t.jsx)(n.h3,{id:"1-replacing-shell-scripts",children:"1. Replacing Shell Scripts"}),"\n",(0,t.jsx)(n.p,{children:"Our older containers relied heavily on shell scripts for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Setting environment variables"}),"\n",(0,t.jsx)(n.li,{children:"Running database migrations"}),"\n",(0,t.jsx)(n.li,{children:"Checking dependencies before startup"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"With no shell available, I had to rethink this completely."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution:"})," I rewrote many of these scripts in ",(0,t.jsx)(n.strong,{children:"Go"}),".\nThis made the logic type-safe, testable, and independent of any shell interpreter."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Old startup.sh\n#!/bin/bash\necho "Waiting for database..."\nuntil nc -z $DB_HOST 5432; do\n  sleep 1\ndone\necho "Database is up!"\n./app\n'})}),"\n",(0,t.jsx)(n.p,{children:"Converted to Go:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "net"\n    "os"\n    "time"\n)\n\nfunc waitForDB(host string, port string) {\n    for {\n        conn, err := net.DialTimeout("tcp", net.JoinHostPort(host, port), 2*time.Second)\n        if err == nil {\n            conn.Close()\n            fmt.Println("Database is up!")\n            return\n        }\n        fmt.Println("Waiting for database...")\n        time.Sleep(1 * time.Second)\n    }\n}\n\nfunc main() {\n    waitForDB(os.Getenv("DB_HOST"), "5432")\n    // Start app here\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"This approach made each container self-contained and completely distroless-friendly."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"2-using-init-containers-for-legacy-tasks",children:"2. Using Init Containers for Legacy Tasks"}),"\n",(0,t.jsxs)(n.p,{children:["Some older scripts were too complex to rewrite immediately.\nIn those cases, I used ",(0,t.jsx)(n.strong,{children:"Kubernetes init containers"})," (based on lightweight images like Alpine or Debian) to handle:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Database migrations"}),"\n",(0,t.jsx)(n.li,{children:"Configuration setup"}),"\n",(0,t.jsx)(n.li,{children:"Any one-time startup logic"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"After the init containers completed, the main service ran in the distroless container.\nThis hybrid approach made the transition much smoother."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"3-debugging-without-a-shell",children:"3. Debugging Without a Shell"}),"\n",(0,t.jsxs)(n.p,{children:["Debugging was one of the biggest challenges initially.\nMy usual \u201c",(0,t.jsx)(n.code,{children:"docker exec"})," into the pod\u201d workflow no longer worked."]}),"\n",(0,t.jsx)(n.p,{children:"What helped:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Running ",(0,t.jsx)(n.strong,{children:"debug tools"})," in separate ephemeral containers (",(0,t.jsx)(n.code,{children:"kubectl debug"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Writing ",(0,t.jsx)(n.strong,{children:"structured logs"})," with clear log levels"]}),"\n",(0,t.jsxs)(n.li,{children:["Adding proper ",(0,t.jsx)(n.strong,{children:"readiness and liveness probes"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Over time, I began relying more on observability and logs instead of manual inspection."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"4-multi-stage-docker-builds",children:"4. Multi-Stage Docker Builds"}),"\n",(0,t.jsx)(n.p,{children:"Here\u2019s an example of a typical multi-stage Dockerfile after migration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dockerfile",children:'# Stage 1: Build the binary\nFROM golang:1.23 AS builder\nWORKDIR /app\nCOPY . .\nRUN go build -o main .\n\n# Stage 2: Run using a distroless base\nFROM gcr.io/distroless/base-debian12\nWORKDIR /\nCOPY --from=builder /app/main /\nUSER nonroot:nonroot\nENTRYPOINT ["/main"]\n'})}),"\n",(0,t.jsx)(n.p,{children:"This pattern ensures the final image is small, secure, and free of unnecessary build tools."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"other-lessons-learned",children:"Other Lessons Learned"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pin image digests"})," instead of tags \u2014 distroless images are updated frequently."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use non-root users"})," \u2014 distroless makes this straightforward with ",(0,t.jsx)(n.code,{children:"nonroot:nonroot"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Keep base images consistent"})," across services to simplify maintenance."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Document startup logic"})," \u2014 once shell scripts are gone, other developers might need clarity."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"final-thoughts",children:"Final Thoughts"}),"\n",(0,t.jsxs)(n.p,{children:["Migrating to distroless containers isn\u2019t just a technical change \u2014 it\u2019s a ",(0,t.jsx)(n.strong,{children:"shift in mindset"}),".\nYou move from treating containers as mini operating systems to treating them as ",(0,t.jsx)(n.strong,{children:"immutable binaries"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The transition can be challenging, especially if your workflows depend heavily on shell utilities, but the ",(0,t.jsx)(n.strong,{children:"security, performance, and consistency gains"})," make it worth the effort."]}),"\n",(0,t.jsx)(n.p,{children:"If you\u2019re planning a migration:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Start small."}),"\n",(0,t.jsx)(n.li,{children:"Keep a debug-friendly fallback."}),"\n",(0,t.jsx)(n.li,{children:"Refactor gradually."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"In the end, your containers will be lighter, faster, and truly production-ready."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(6540);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);